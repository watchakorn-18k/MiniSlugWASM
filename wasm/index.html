<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no"
    />
    <title>MiniSlug</title>
    <style>
      body,
      html {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        background-color: black;
        overflow: hidden;
      }

      canvas {
        display: block;
        width: 100%;
        height: 100%;
        object-fit: contain;
        image-rendering: pixelated;
        image-rendering: crisp-edges;
        /* Center the canvas if object-fit leaves space */
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        margin: auto;
      }

      .loading {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: #e94560;
        font-family: sans-serif;
        font-size: 1.2rem;
        pointer-events: none;
        text-align: center;
        z-index: 10;
      }

      .loading-spinner {
        width: 40px;
        height: 40px;
        border: 4px solid rgba(233, 69, 96, 0.2);
        border-top-color: #e94560;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 1rem;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body>
    <div id="loading" class="loading">
      <div class="loading-spinner"></div>
      <p>Loading...</p>
    </div>

    <canvas
      id="canvas"
      oncontextmenu="event.preventDefault()"
      tabindex="-1"
    ></canvas>

    <script>
      var Module = {
        canvas: (function () {
          var canvas = document.getElementById("canvas");

          canvas.addEventListener(
            "webglcontextlost",
            function (e) {
              console.error("WebGL context lost");
              e.preventDefault();
            },
            false
          );

          // Ensure canvas gets focus for keyboard input
          canvas.addEventListener("click", function () {
            canvas.focus();
          });

          return canvas;
        })(),
        onRuntimeInitialized: function () {
          var loadingDiv = document.getElementById("loading");
          if (loadingDiv) loadingDiv.style.display = "none";
          document.getElementById("canvas").focus();
        },
        setStatus: function (text) {
          var loadingP = document.querySelector("#loading p");
          if (loadingP) loadingP.textContent = text;
          console.log("Status:", text);
        },
        totalDependencies: 0,
        monitorRunDependencies: function (left) {
          this.totalDependencies = Math.max(this.totalDependencies, left);
          this.setStatus(
            left
              ? "Loading... (" +
                  (this.totalDependencies - left) +
                  "/" +
                  this.totalDependencies +
                  ")"
              : "Ready!"
          );
        },
      };
    </script>
    {{{ SCRIPT }}}
  </body>
</html>
